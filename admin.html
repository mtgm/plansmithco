<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>PlanSmithCo - YÃ¶netim Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --surface: #ffffff; --border: #e2e8f0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #1e293b; }
        
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Kartlar */
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        
        h1, h2 { margin-top: 0; }
        h1 { font-size: 24px; color: #0f172a; display: flex; align-items: center; gap: 10px; }
        
        /* Formlar */
        label { display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 4px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; margin-bottom: 12px; box-sizing: border-box; }
        
        /* Butonlar */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-success { background: #10b981; color: white; width: 100%; justify-content: center; font-size: 16px; padding: 15px; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; padding: 6px 12px; font-size: 12px; }
        
        /* Durum MesajlarÄ± */
        #status-bar { position: fixed; bottom: 20px; right: 20px; padding: 12px 24px; background: #333; color: white; border-radius: 8px; display: none; z-index: 100; }
        .loading { opacity: 0.5; pointer-events: none; cursor: wait; }

        /* Login EkranÄ± */
        #login-screen { display: flex; }
        #app-screen { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen" class="card" style="max-width: 400px; margin: 100px auto;">
            <div style="width: 100%;">
                <h2>ğŸ” Admin GiriÅŸi</h2>
                <p style="color:#666; font-size:13px; margin-bottom:20px;">GitHub EriÅŸim Bilgileri</p>
                
                <label>GitHub Token</label>
                <input type="password" id="gh-token" placeholder="ghp_...">
                
                <label>KullanÄ±cÄ± AdÄ± (Owner)</label>
                <input type="text" id="gh-owner" placeholder="Ã–rn: PlanSmithCo">
                
                <label>Repo AdÄ±</label>
                <input type="text" id="gh-repo" placeholder="Ã–rn: showroom">
                
                <button class="btn btn-primary" style="width:100%" onclick="login()">BaÄŸlan</button>
            </div>
        </div>

        <div id="app-screen">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h1>ğŸ› ï¸ ÃœrÃ¼n YÃ¶neticisi</h1>
                <button class="btn" onclick="logout()" style="background:#e2e8f0; font-size:12px;">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>

            <div class="card">
                <h2>ğŸ“ Products.json EditÃ¶rÃ¼</h2>
                <p style="font-size:13px; color:#666;">ÃœrÃ¼nlerin fiyatlarÄ±nÄ±, isimlerini ve Ã¶zelliklerini buradan dÃ¼zenleyebilirsiniz.</p>
                
                <textarea id="json-editor" style="height: 500px; font-family: 'Monaco', monospace; font-size: 13px; background: #1e293b; color: #a5b4fc; line-height: 1.5; padding: 15px;"></textarea>
                
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="formatJSON()">Kodu DÃ¼zenle (Formatla)</button>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn btn-success" onclick="saveToGithub()">ğŸ’¾ KAYDET VE SÄ°TEYÄ° GÃœNCELLE</button>
                <p style="text-align: center; font-size: 12px; color: #64748b; margin-top: 10px;">
                    Bu butona bastÄ±ktan yaklaÅŸÄ±k 1-2 dakika sonra web sitesi otomatik olarak gÃ¼ncellenecektir.
                </p>
            </div>
        </div>
    </div>

    <div id="status-bar"></div>

    <script>
        // --- AYARLAR ---
        // products.json dosyasÄ±nÄ±n repo iÃ§indeki tam yolu. 
        // EÄŸer dosyayÄ± ana dizine koyduysan 'products.json' yaz.
        // EÄŸer 'public' klasÃ¶rÃ¼ndeyse 'public/products.json' yaz.
        const PRODUCTS_PATH = 'products.json'; 

        let GITHUB_TOKEN = '';
        let REPO_OWNER = '';
        let REPO_NAME = '';
        let productsSha = ''; // DosyayÄ± gÃ¼ncellerken GitHub bunu ister (Ã‡akÄ±ÅŸma olmasÄ±n diye)

        // --- BAÅLANGIÃ‡ ---
        window.onload = () => {
            const storedToken = localStorage.getItem('gh_token');
            if(storedToken) {
                document.getElementById('gh-token').value = storedToken;
                document.getElementById('gh-owner').value = localStorage.getItem('gh_owner');
                document.getElementById('gh-repo').value = localStorage.getItem('gh_repo');
            }
        };

        async function login() {
            GITHUB_TOKEN = document.getElementById('gh-token').value;
            REPO_OWNER = document.getElementById('gh-owner').value;
            REPO_NAME = document.getElementById('gh-repo').value;

            if(!GITHUB_TOKEN || !REPO_OWNER || !REPO_NAME) {
                showToast("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
                return;
            }

            // Bilgileri tarayÄ±cÄ±ya kaydet (MÃ¼ÅŸteri bir daha girmek zorunda kalmasÄ±n)
            localStorage.setItem('gh_token', GITHUB_TOKEN);
            localStorage.setItem('gh_owner', REPO_OWNER);
            localStorage.setItem('gh_repo', REPO_NAME);

            showToast("Veriler GitHub'dan Ã§ekiliyor...");
            try {
                await loadData();
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'block';
                showToast("BaÄŸlantÄ± BaÅŸarÄ±lÄ±!");
            } catch (e) {
                console.error(e);
                showToast("Hata: " + e.message);
            }
        }

        function logout() {
            if(confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // --- GITHUB API FONKSÄ°YONLARI ---
        async function fetchFile(path) {
            const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`;
            const res = await fetch(url, {
                headers: { 
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            if(!res.ok) {
                if(res.status === 404) throw new Error(`Dosya bulunamadÄ±: ${path}. Dosya yolunu kontrol edin.`);
                if(res.status === 401) throw new Error(`Yetkisiz GiriÅŸ! Token hatalÄ±.`);
                throw new Error(`Hata kodu: ${res.status}`);
            }
            
            const data = await res.json();
            // TÃ¼rkÃ§e karakterleri bozmadan decode et
            const content = decodeURIComponent(escape(window.atob(data.content)));
            return { content, sha: data.sha };
        }

        async function loadData() {
            // Sadece Products.json Ã§ekiyoruz
            const prodData = await fetchFile(PRODUCTS_PATH);
            productsSha = prodData.sha;
            
            // EditÃ¶re doldur
            const jsonObject = JSON.parse(prodData.content);
            document.getElementById('json-editor').value = JSON.stringify(jsonObject, null, 2);
        }

        // --- JSON Ä°ÅLEMLERÄ° ---
        function formatJSON() {
            const editor = document.getElementById('json-editor');
            try {
                const val = JSON.parse(editor.value);
                editor.value = JSON.stringify(val, null, 2);
                showToast("Format dÃ¼zeltildi âœ…");
                return true;
            } catch (e) {
                alert("HATA: JSON formatÄ± bozuk! Bir virgÃ¼l veya parantez hatasÄ± olabilir.\n\n" + e.message);
                return false;
            }
        }

        // --- KAYDETME (DEPLOY) ---
        async function saveToGithub() {
            if(!confirm("Bu iÅŸlem dosyayÄ± gÃ¼ncelleyecek ve siteyi yeniden yayÄ±nlayacak.\nOnaylÄ±yor musunuz?")) return;
            
            // Ã–nce JSON'un dÃ¼zgÃ¼n olup olmadÄ±ÄŸÄ±nÄ± kontrol et
            if(!formatJSON()) return;

            showToast("GitHub'a kaydediliyor...");
            document.body.classList.add('loading'); // EkranÄ± dondur

            try {
                const newContent = document.getElementById('json-editor').value;
                
                // GitHub'a PUT isteÄŸi at
                await updateFile(PRODUCTS_PATH, newContent, productsSha, "Admin Panel: ÃœrÃ¼n GÃ¼ncellemesi");
                
                showToast("âœ… BAÅARILI! Vercel gÃ¼ncellemesi baÅŸladÄ±.");
                alert("Ä°ÅŸlem BaÅŸarÄ±lÄ±!\n\nDeÄŸiÅŸiklikler GitHub'a gÃ¶nderildi. Vercel sitenizi yaklaÅŸÄ±k 1-2 dakika iÃ§inde otomatik olarak gÃ¼ncelleyecektir.");
                
                // SHA'yÄ± gÃ¼ncelle (PeÅŸ peÅŸe kayÄ±t yapÄ±labilmesi iÃ§in)
                await loadData(); 

            } catch (e) {
                console.error(e);
                alert("Kaydetme sÄ±rasÄ±nda hata oluÅŸtu:\n" + e.message);
            } finally {
                document.body.classList.remove('loading'); // EkranÄ± aÃ§
            }
        }

        async function updateFile(path, content, sha, message) {
            const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`;
            // TÃ¼rkÃ§e karakter uyumlu Base64 encode
            const contentBase64 = window.btoa(unescape(encodeURIComponent(content)));

            const body = {
                message: message,
                content: contentBase64,
                sha: sha // Bu dosyanÄ±n Ã¼zerine yazacaÄŸÄ±mÄ±zÄ± kanÄ±tlayan imza
            };

            const res = await fetch(url, {
                method: 'PUT',
                headers: { 
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });

            if(!res.ok) {
                const err = await res.json();
                throw new Error(err.message);
            }
        }

        function showToast(msg) {
            const el = document.getElementById('status-bar');
            el.innerText = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 4000);
        }
    </script>
</body>
</html>